
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ç™½æ—©é¤åº— - äº«å—ç¾å¥½çš„æ—©æ™¨æ™‚å…‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJg1dJmQZkI8b8rF2lE0q/lCgU6D0m9t/fPqY3i5WnJjRkI3T0E8XgJ9c5Q=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* å®šç¾©è«è˜­è¿ªè‰²ç³» */
        :root {
            --color-primary: #9CAEA9;
            /* è«è˜­è¿ªç°ç¶  */
            --color-secondary: #C9A7A7;
            /* è«è˜­è¿ªç°ç²‰ */
            --color-background: #f8f8f8;
            /* æ·ºç°ç±³ç™½ */
            --color-text-dark: #333333;
        }

        /* è‡ªå®šç¾©èƒŒæ™¯ç´‹ç† - ä½¿ç”¨ Base64 æˆ–å¤–éƒ¨åœ–ç‰‡ */
        .textured-bg {
            background-image: url(img/xv.png);
            background-repeat: repeat;
        }

        /* èœå–®å±•é–‹ CSS èª¿æ•´ï¼šä½¿ç”¨ max-height æ­é… transition å¯¦ç¾å±•é–‹æ”¶åˆå‹•ç•« */
        .menu-detail {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s ease-in-out;
        }

        /* åœ¨éè§¸æ§è£ç½®ä¸Šï¼Œhover ä»ç„¶è§¸ç™¼èœå–®å±•é–‹ */
        .menu-card:hover .menu-detail {
            max-height: 550px;
            /* éœ€è¶³å¤ å¤§ä»¥å®¹ç´æ‰€æœ‰èœå–®é … */
        }

        /* è³¼ç‰©è»Šå´é‚Šæ¬„å‹•ç•« */
        .cart-sidebar {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }

        .cart-sidebar.open {
            transform: translateX(0);
        }

        /* é»æ“Šèœå–®å¡ç‰‡åœ¨æ‰‹æ©Ÿä¸Šä¹Ÿèƒ½å±•é–‹ (è¦†è“‹ CSS hover) */
        .menu-card.active .menu-detail {
            max-height: 550px;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': 'var(--color-primary)',
                        'secondary': 'var(--color-secondary)',
                        'background': 'var(--color-background)',
                        'text-dark': 'var(--color-text-dark)',
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
</head>

<body class="bg-background textured-bg font-sans text-text-dark antialiased">

    <!-- è³¼ç‰©è»ŠæŒ‰éˆ• (æµ®å‹•/å›ºå®š) -->
    <button id="cart-button"
        class="fixed bottom-6 right-6 z-50 p-4 rounded-full bg-secondary text-white shadow-xl hover:bg-primary transition duration-300 transform hover:scale-110 focus:outline-none">
        <i class="fas fa-shopping-cart text-xl"></i>
        <!-- è³¼ç‰©è»Šæ•¸é‡æ¨™ç±¤ -->
        <span id="cart-count"
            class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">0</span>
    </button>

    <!-- è³¼ç‰©è»Šå´é‚Šæ¬„/Modal UI -->
    <div id="cart-sidebar"
        class="cart-sidebar fixed top-0 right-0 w-full md:w-96 h-full bg-white z-50 shadow-2xl flex flex-col">
        <div class="p-6 border-b border-primary/50 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-primary">ğŸ›’ æ‚¨çš„è¨‚å–®</h2>
            <button id="close-cart-button" class="text-gray-500 hover:text-red-500 transition focus:outline-none">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>

        <!-- è³¼ç‰©è»Šå…§å®¹å€ -->
        <div id="cart-items-container" class="flex-grow p-6 overflow-y-auto space-y-4">
            <!-- è³¼ç‰©è»Šé …ç›®å°‡ç”± JS æ¸²æŸ“åœ¨æ­¤è™• -->
            <p id="cart-empty-message" class="text-gray-500 text-center mt-10">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œå¿«å»é»é¤å§ï¼</p>
        </div>

        <!-- ç¸½è¨ˆèˆ‡çµå¸³æŒ‰éˆ• -->
        <div id="cart-footer" class="p-6 border-t border-primary/50 bg-gray-50">
            <div class="flex justify-between items-center text-xl font-bold mb-4">
                <span>ç¸½è¨ˆ:</span>
                <span id="cart-total" class="text-secondary">NT$ 0</span>
            </div>
            <button id="checkout-button"
                class="w-full py-3 rounded-lg bg-primary text-white font-semibold shadow-lg hover:bg-primary/80 transition duration-200 disabled:opacity-50"
                disabled>
                ç¢ºèªè¨‚å–®ä¸¦çµå¸³
            </button>
            <p class="text-xs text-center text-gray-400 mt-2">ï¼ˆæ­¤ç‚ºç¤ºç¯„åŠŸèƒ½ï¼Œå¯¦éš›çµå¸³éœ€è‡³æ«ƒæª¯ï¼‰</p>
        </div>
    </div>
    <!-- è³¼ç‰©è»ŠèƒŒæ™¯é®ç½© -->
    <div id="cart-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity"></div>
    <!-- è³¼ç‰©è»ŠUIçµæŸ -->

    <header id="navbar" class="fixed w-full z-50 bg-background/90 backdrop-blur-sm shadow-lg transition duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
            <a href="#hero" class="text-2xl font-bold text-primary hover:text-secondary transition">å¤ç™½ æ—©é¤åº—</a>

            <nav class="hidden md:flex space-x-8">
                <a href="#menu" class="text-base font-medium hover:text-primary transition">èœå–®</a>
                <a href="#recommend" class="text-base font-medium hover:text-primary transition">ç†±é–€æ¨è–¦</a>
                <a href="#about" class="text-base font-medium hover:text-primary transition">é—œæ–¼æˆ‘å€‘</a>
                <a href="#contact" class="text-base font-medium hover:text-primary transition">è¯çµ¡æˆ‘å€‘</a>
            </nav>

            <button id="menu-button" class="md:hidden text-text-dark hover:text-primary p-2 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7">
                    </path>
                </svg>
            </button>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-background shadow-lg">
            <nav class="px-2 pt-2 pb-3 space-y-1">
                <a href="#menu"
                    class="block px-3 py-2 rounded-md text-base font-medium hover:bg-secondary/50 transition">èœå–®</a>
                <a href="#recommend"
                    class="block px-3 py-2 rounded-md text-base font-medium hover:bg-secondary/50 transition">ç†±é–€æ¨è–¦</a>
                <a href="#about"
                    class="block px-3 py-2 rounded-md text-base font-medium hover:bg-secondary/50 transition">é—œæ–¼æˆ‘å€‘</a>
                <a href="#contact"
                    class="block px-3 py-2 rounded-md text-base font-medium hover:bg-secondary/50 transition">è¯çµ¡æˆ‘å€‘</a>
            </nav>
        </div>
    </header>

    <main>
        <section id="hero" class="relative min-h-screen flex items-center justify-center pt-16"
            style="background-image: linear-gradient(135deg, var(--color-background) 0%, var(--color-primary) 100%);">
            <div class="max-w-4xl mx-auto text-center p-8">
                <div
                    class="w-48 h-48 md:w-64 md:h-64 rounded-full mx-auto mb-6 bg-secondary/80 flex items-center justify-center shadow-xl">
                    <img src="img/CUP.png" alt="æ—©é¤æ’åœ–" class="w-full h-full rounded-full object-cover shadow-xl">
                </div>

                <h1 class="text-5xl sm:text-7xl lg:text-8xl font-extrabold leading-tight text-text-dark">
                    å¤ç™½ æ—©é¤åº—
                </h1>
                <p class="mt-4 text-xl sm:text-3xl text-gray-600 font-light">
                    ç”¨å¤ç™½æ—©é¤ï¼Œé–‹å•Ÿç¾å¥½çš„ä¸€å¤©ã€‚
                </p>
                <div class="mt-8">
                    <a href="#menu"
                        class="inline-flex items-center px-8 py-3 border border-transparent text-lg font-medium rounded-full shadow-lg text-white bg-primary hover:bg-secondary hover:text-text-dark transition duration-300">
                        æŸ¥çœ‹å®Œæ•´èœå–® &darr;
                    </a>
                </div>
            </div>
        </section>


        <section id="about" class="py-20 bg-background/80">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold text-primary mb-10">â˜•æˆ‘å€‘çš„ç†å¿µ</h2>

                <div class="max-w-3xl mx-auto text-lg text-gray-700 space-y-6">
                    <p class="text-xl font-medium">ã€Œå¾ä¸€ä»½ç²¾å¿ƒè£½ä½œçš„æ—©é¤é–‹å§‹ï¼Œè®“æ‚¨çš„æ¯ä¸€å¤©éƒ½å……æ»¿èƒ½é‡èˆ‡æº«æš–ã€‚ã€</p>
                    <p>æˆ‘å€‘å …ä¿¡ï¼Œç°¡å–®çš„é£Ÿæä¹Ÿèƒ½å¸¶ä¾†å¤§å¤§çš„å¹¸ç¦ã€‚è‡´åŠ›æ–¼ç‚ºé™„è¿‘çš„é„°é‡Œæä¾›æ–°é®®ã€å¥åº·çš„æ—©é»ã€‚æˆ‘å€‘å …æŒä½¿ç”¨é«˜å“è³ªçš„é£Ÿæï¼Œç¾é»ç¾åšï¼Œç¢ºä¿æ¯ä¸€å£éƒ½æ˜¯æœ€æ£’çš„æ»‹å‘³ã€‚</p>
                    <p>é€™è£¡ä¸åªæ˜¯å¡«é£½è‚šå­çš„åœ°é»ï¼Œæ›´æ˜¯æ‚¨äº«å—æ—©æ™¨æ™‚å…‰çš„èˆ’é©è§’è½ã€‚æ­¡è¿æ‚¨ä¾†æ„Ÿå—é€™ä»½ç°¡ç´„èˆ‡å„ªé›…ï¼</p>
                </div>
            </div>
        </section>


        <!-- èœå–®å€å¡Š - å…§å®¹å°‡ç”± JS å‹•æ…‹æ¸²æŸ“ -->
        <section id="menu" class="py-20 bg-background/80">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-center text-primary mb-12">â˜•èœå–®</h2>

                <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- èœå–®åˆ†é¡å¡ç‰‡å°‡ç”± JavaScript æ¸²æŸ“ -->
                </div>
            </div>
        </section>
        <!-- èœå–®å€å¡ŠçµæŸ -->



        <section id="recommend" class="py-20 bg-white textured-bg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-center text-primary mb-12">â˜•ä»Šæ—¥ç†±é–€æ¨è–¦</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-4xl mx-auto">

                    <!-- ç†±é–€æ¨è–¦é …ç›® 1 -->
                    <div
                        class="flex flex-col items-center text-center p-6 border border-gray-200 rounded-lg shadow-md group transition duration-300 hover:shadow-xl transform hover:scale-[1.02]">
                        <img src="img/å¥åº·å…¨éº¥é–‹æ”¾å¼.jfif" alt="åŸ¹æ ¹è›‹åå¸"
                            class="w-full h-56 object-cover rounded-md mb-4 group-hover:ring-4 group-hover:ring-secondary/50 transition">
                        <h3 class="text-3xl font-bold text-primary mb-2">ğŸ¥ªåŸ¹æ ¹è›‹åå¸</h3>
                        <p class="text-gray-600 text-lg">æ‹›ç‰Œé¦–é¸ï¼é¬†è»Ÿåå¸æ­é…å«©ç…é›è›‹å’Œå„ªè³ªåŸ¹æ ¹ï¼Œç¶“å…¸ç¾å‘³ä¸æ•—ã€‚</p>
                        <span class="mt-3 text-xl font-semibold text-secondary">NT$ 40</span>
                        <!-- æ–°å¢ï¼šåŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ• -->
                        <button data-item-id="single_bacon_egg_toast" data-item-name="åŸ¹æ ¹è›‹åå¸" data-item-price="40"
                            class="add-to-cart-btn mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-full shadow-sm text-white bg-secondary hover:bg-secondary/80 transition duration-150">
                            <i class="fas fa-plus mr-2"></i> åŠ å…¥è³¼ç‰©è»Š
                        </button>
                    </div>
                    <!-- ç†±é–€æ¨è–¦é …ç›® 2 -->
                    <div
                        class="flex flex-col items-center text-center p-6 border border-gray-200 rounded-lg shadow-md group transition duration-300 hover:shadow-xl transform hover:scale-[1.02]">
                        <img src="img/é¦™æ¿ƒå¥¶èŒ¶.jfif" alt="é¦™æ¿ƒå¥¶èŒ¶"
                            class="w-full h-56 object-cover rounded-md mb-4 group-hover:ring-4 group-hover:ring-secondary/50 transition">
                        <h3 class="text-3xl font-bold text-primary mb-2">ğŸ§‹é¦™æ¿ƒå¥¶èŒ¶</h3>
                        <p class="text-gray-600 text-lg">æ¯æ—¥ç¾ç…®å¤æ—©å‘³ç´…èŒ¶ï¼ŒåŠ å…¥æ¿ƒé†‡é®®å¥¶ï¼Œç”œè€Œä¸è†©ï¼Œå®Œç¾æ­é…ï¼</p>
                        <span class="mt-3 text-xl font-semibold text-secondary">NT$ 25</span>
                        <!-- æ–°å¢ï¼šåŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ• -->
                        <button data-item-id="drink_milk_tea" data-item-name="é¦™æ¿ƒå¥¶èŒ¶" data-item-price="25"
                            class="add-to-cart-btn mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-full shadow-sm text-white bg-secondary hover:bg-secondary/80 transition duration-150">
                            <i class="fas fa-plus mr-2"></i> åŠ å…¥è³¼ç‰©è»Š
                        </button>
                    </div>

                </div>
            </div>
        </section>



        <section id="contact" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold text-primary mb-10">è¯çµ¡æˆ‘å€‘</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

                    <div class="bg-gray-100 p-4 rounded-lg shadow-md">
                        <h3 class="text-2xl font-semibold mb-4 text-secondary">ä¾†åº—è·¯ç·š</h3>
                        <div
                            class="aspect-w-16 aspect-h-9 h-80 w-full bg-gray-300 flex items-center justify-center rounded-md overflow-hidden">
                            <iframe
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d33859098.71777257!2d-12.32858730000005!3d-58.80400019999999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xb09dff882a7809e1%3A0xb08d0a385dc8c7c7!2sAntarctica!5e0!3m2!1szh-TW!2stw!4v1763879948100!5m2!1szh-TW!2stw"
                                width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade">
                            </iframe>
                        </div>
                        <p class="mt-4 text-lg text-gray-700 font-bold">åœ°å€ï¼šå—æ¥µ</p>
                        <p class="text-sm text-gray-500">ï¼ˆè¿‘ å—æ¥µç§‘è€ƒç«™ï¼Œå¾å°åŒ—æ­¥è¡Œç´„ 375å¤©ï¼‰</p>
                    </div>

                    <div class="flex flex-col justify-center items-center p-4">
                        <h3 class="text-2xl font-semibold mb-6 text-secondary">ç‡Ÿæ¥­è³‡è¨Š</h3>
                        <div class="space-y-4 text-lg text-gray-700 w-full max-w-sm">
                            <p class="flex items-center"><i class="fas fa-clock text-primary w-8"></i> ç‡Ÿæ¥­æ™‚é–“ï¼š 06:00
                                -
                                14:00 (é€±ä¸€è‡³é€±äº”)</p>
                            <p class="flex items-center"><i class="fas fa-calendar-times text-primary w-8"></i> å…¬ä¼‘æ—¥ï¼š
                                æ¯é€±å…­ã€æ—¥</p>
                            <p class="flex items-center"><i class="fas fa-phone text-primary w-8"></i> é›»è©±ï¼š
                                113080012</p>
                            <p class="flex items-center"><i class="fas fa-envelope text-primary w-8"></i> Emailï¼š
                                homework@example.com</p>
                        </div>

                        <h3 class="text-2xl font-semibold mt-10 mb-4 text-secondary">è¿½è¹¤æˆ‘å€‘</h3>
                        <div class="flex space-x-6">
                            <!-- Facebook åœ–ç‰‡ç‰ˆ -->
                            <a href="https://youtu.be/dQw4w9WgXcQ?si=YxVJYQ_M3zEEuy0D" target="_blank"
                                class="p-4 rounded-full shadow-lg transition duration-300 flex items-center justify-center bg-gray-200 hover:bg-blue-600">
                                <img src="img/fb.png" alt="Facebook" class="w-6 h-6">
                            </a>

                            <!-- Instagram åœ–ç‰‡ç‰ˆ -->
                            <a href="https://youtu.be/dQw4w9WgXcQ?si=YxVJYQ_M3zEEuy0D" target="_blank"
                                class="p-4 rounded-full shadow-lg transition duration-300 flex items-center justify-center bg-gray-200 hover:bg-pink-500">
                                <img src="img/ig.png" alt="Instagram" class="w-6 h-6">
                            </a>

                            <!-- Line åœ–ç‰‡ç‰ˆ -->
                            <a href="https://youtu.be/dQw4w9WgXcQ?si=YxVJYQ_M3zEEuy0D" target="_blank"
                                class="p-4 rounded-full shadow-lg transition duration-300 flex items-center justify-center bg-gray-200 hover:bg-green-500">
                                <img src="img/line.png" alt="Line" class="w-6 h-6">
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-primary py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white">
            <p class="text-base font-medium">ã€Œç‚ºæ‚¨çš„ä¸€å¤©ï¼Œæä¾›æœ€ç¾å¥½çš„é–‹å§‹ã€‚ã€</p>
            <p class="text-xs mt-2">&copy; 2025 XX æ—©é¤åº—ã€‚è¨­è¨ˆï¼šTailwind CSS / RWD</p>
        </div>
    </footer>


    <!-- Firebase è…³æœ¬å¼•å…¥ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, writeBatch, FieldValue, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // è¨­å®š Firebase Debug Log
        setLogLevel('Debug');

        // --- Firebase åˆå§‹åŒ–å’Œèªè­‰ ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        let app, db, auth, userId = null;
        let isAuthReady = false;

        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // è™•ç†èªè­‰
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    if (typeof __initial_auth_token !== 'undefined') {
                        await signInWithCustomToken(auth, __initial_auth_token).catch(e => {
                            console.error("Custom Token Sign-in Failed:", e);
                            signInAnonymously(auth); // Fallback to anonymous
                        });
                    } else {
                        await signInAnonymously(auth);
                    }
                }
                isAuthReady = true;
                console.log(`Firebase Auth Ready. User ID: ${userId}`);
            });
        } else {
            console.error("Firebase Configuration is missing.");
            isAuthReady = true; // Still allow app logic to run, but storage will fail.
        }

        // --- èœå–®è³‡æ–™çµæ§‹ ---
        const fullMenu = [
            {
                id: 'main_combo',
                title: 'ğŸ›ç¶“å…¸å¥—é¤',
                imgSrc: 'img/åŸ¹æ ¹è›‹åå¸äº«å—æƒ…å¢ƒ.png',
                categoryName: 'ç¶“å…¸å¥—é¤ (å«ä¸­æ¯ç´…èŒ¶)',
                items: [
                    { id: 'combo_ham_toast', name: 'ç«è…¿è›‹åå¸å¥—é¤', price: 85 },
                    { id: 'combo_bacon_sandwich', name: 'åŸ¹æ ¹è›‹ä¸‰æ˜æ²»å¥—é¤', price: 90 },
                    { id: 'combo_radish_cake', name: 'è˜¿è””ç³•ï¼‹è·åŒ…è›‹å¥—é¤', price: 80 },
                    { id: 'combo_omelet_burger', name: 'ç…è›‹æ¼¢å ¡å¥—é¤', price: 95 },
                    { id: 'combo_cheese_egg_roll', name: 'èµ·å¸è›‹é¤…å¥—é¤', price: 80 },
                ],
                theme: { bgClass: 'bg-primary', detailBorder: 'border-secondary', titleColor: 'text-white' }
            },
            {
                id: 'a_la_carte',
                title: 'ğŸ³å–®é»é»å¿ƒ',
                imgSrc: 'img/æ¨™æº–ç‚¸è–¯æ¢.jfif',
                categoryName: 'å–®é»åŠ è³¼',
                items: [
                    { id: 'single_radish_cake', name: 'è˜¿è””ç³•', price: 25 },
                    { id: 'single_egg_roll', name: 'è›‹é¤…', price: 25 },
                    { id: 'single_bacon', name: 'åŸ¹æ ¹', price: 30 },
                    { id: 'single_thick_toast', name: 'åšç‰‡åå¸', price: 20 },
                    { id: 'single_hotdog', name: 'å°ç†±ç‹—', price: 20 },
                ],
                theme: { bgClass: 'bg-secondary', detailBorder: 'border-primary', titleColor: 'text-white' }
            },
            {
                id: 'drinks',
                title: 'ğŸ¥¤é£²å“',
                imgSrc: 'img/å’–å•¡æ¯ç‰¹å¯«.png',
                categoryName: 'é£²å“ç³»åˆ— (å†·/ç†±)',
                items: [
                    { id: 'drink_soy', name: 'è±†æ¼¿', price: 20 },
                    { id: 'drink_milk_tea', name: 'å¥¶èŒ¶', price: 25 },
                    { id: 'drink_green_tea', name: 'ç¶ èŒ¶', price: 25 },
                    { id: 'drink_coffee', name: 'å’–å•¡', price: 30 },
                    { id: 'drink_iced_black_tea', name: 'å†°ç´…èŒ¶', price: 20 },
                ],
                theme: { bgClass: 'bg-primary', detailBorder: 'border-secondary', titleColor: 'text-white' }
            }
        ];

        // --- æ ¸å¿ƒè³¼ç‰©è»Šé‚è¼¯ï¼ˆFirestore äº’å‹•ï¼‰ ---
        const getCartCollectionRef = () => {
            if (!userId || !db) return null;
            // ç§äººè³¼ç‰©è»Šè³‡æ–™è·¯å¾‘: /artifacts/{appId}/users/{userId}/cartItems
            return collection(db, `artifacts/${appId}/users/${userId}/cartItems`);
        };

        /**
         * å°‡å•†å“åŠ å…¥è³¼ç‰©è»Šæˆ–æ›´æ–°æ•¸é‡
         * @param {string} itemId - å•†å“å”¯ä¸€ ID (Firestore document ID)
         * @param {string} name - å•†å“åç¨±
         * @param {number} price - å•†å“åƒ¹æ ¼
         */
        const addToCart = async (itemId, name, price) => {
            if (!isAuthReady || !userId) {
                console.error("Auth not ready. Cannot add to cart.");
                return;
            }
            const cartRef = getCartCollectionRef();
            if (!cartRef) return;

            const itemDocRef = doc(cartRef, itemId);

            try {
                // ä½¿ç”¨äº¤æ˜“ä¾†ç¢ºä¿è®€å–å’Œå¯«å…¥çš„åŸå­æ€§
                const itemSnap = await getDoc(itemDocRef);

                if (itemSnap.exists()) {
                    // å¦‚æœå•†å“å·²å­˜åœ¨ï¼Œæ•¸é‡ + 1
                    await updateDoc(itemDocRef, {
                        quantity: increment(1)
                    });
                } else {
                    // å¦å‰‡ï¼Œæ–°å¢å•†å“ï¼Œæ•¸é‡ç‚º 1
                    await setDoc(itemDocRef, {
                        id: itemId,
                        name: name,
                        price: price,
                        quantity: 1,
                        addedAt: new Date().toISOString()
                    });
                }
                showTemporaryMessage("å·²åŠ å…¥è³¼ç‰©è»Šï¼", "text-green-500");
            } catch (error) {
                console.error("Error adding to cart:", error);
                showTemporaryMessage("åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼", "text-red-500");
            }
        };

        /**
         * æ›´æ”¹è³¼ç‰©è»Šå…§å•†å“çš„æ•¸é‡
         * @param {string} itemId - å•†å“ ID
         * @param {number} change - æ•¸é‡è®ŠåŒ–é‡ (+1 æˆ– -1)
         */
        const updateItemQuantity = async (itemId, change) => {
            if (!userId) return;
            const cartRef = getCartCollectionRef();
            if (!cartRef) return;

            const itemDocRef = doc(cartRef, itemId);

            try {
                const itemSnap = await getDoc(itemDocRef);
                if (itemSnap.exists()) {
                    const currentQuantity = itemSnap.data().quantity || 0;
                    const newQuantity = currentQuantity + change;

                    if (newQuantity <= 0) {
                        // æ•¸é‡ç‚º 0 æˆ–æ›´å°‘æ™‚åˆªé™¤æ–‡ä»¶
                        await deleteDoc(itemDocRef);
                    } else {
                        // æ›´æ–°æ•¸é‡
                        await updateDoc(itemDocRef, {
                            quantity: newQuantity
                        });
                    }
                }
            } catch (error) {
                console.error("Error updating cart quantity:", error);
            }
        };

        // --- UI æ¸²æŸ“èˆ‡äº‹ä»¶è™•ç† ---

        const cartItemsContainer = document.getElementById('cart-items-container');
        const cartTotalDisplay = document.getElementById('cart-total');
        const cartCountBadge = document.getElementById('cart-count');
        const checkoutButton = document.getElementById('checkout-button');
        const cartEmptyMessage = document.getElementById('cart-empty-message');

        /**
         * æ¸²æŸ“è³¼ç‰©è»Šå…§å®¹
         * @param {Array<Object>} items - è³¼ç‰©è»Šä¸­çš„å•†å“åˆ—è¡¨
         */
        const renderCart = (items) => {
            cartItemsContainer.innerHTML = '';
            let total = 0;
            let totalCount = 0;

            if (items.length === 0) {
                cartItemsContainer.innerHTML = '<p class="text-gray-500 text-center mt-10">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œå¿«å»é»é¤å§ï¼</p>';
                checkoutButton.disabled = true;
            } else {
                checkoutButton.disabled = false;
                items.forEach(item => {
                    const subtotal = item.price * item.quantity;
                    total += subtotal;
                    totalCount += item.quantity;

                    const itemElement = document.createElement('div');
                    itemElement.className = 'flex justify-between items-center bg-gray-50 p-3 rounded-lg shadow-sm border border-gray-200';
                    itemElement.innerHTML = `
                        <div class="flex-grow">
                            <p class="font-semibold text-text-dark">${item.name}</p>
                            <p class="text-sm text-gray-500">NT$ ${item.price} x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button data-id="${item.id}" class="cart-quantity-minus p-1 text-primary hover:text-secondary transition duration-150">
                                <i class="fas fa-minus-circle"></i>
                            </button>
                            <span class="font-bold w-4 text-center">${item.quantity}</span>
                            <button data-id="${item.id}" class="cart-quantity-plus p-1 text-primary hover:text-secondary transition duration-150">
                                <i class="fas fa-plus-circle"></i>
                            </button>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemElement);
                });
            }

            cartTotalDisplay.textContent = `NT$ ${total}`;
            cartCountBadge.textContent = totalCount;
            cartCountBadge.classList.toggle('hidden', totalCount === 0);
        };

        /**
         * æ¸²æŸ“èœå–®ç¶²æ ¼
         */
        const renderMenuGrid = () => {
            const menuGrid = document.getElementById('menu-grid');
            menuGrid.innerHTML = '';

            fullMenu.forEach(category => {
                let itemsHtml = category.items.map(item => `
                    <li class="flex justify-between items-center py-1 group" data-item-id="${item.id}">
                        <span class="flex-grow">${item.name}</span>
                        <span class="font-semibold text-text-dark mr-4">NT$ ${item.price}</span>
                        <button data-item-id="${item.id}" data-item-name="${item.name}" data-item-price="${item.price}" 
                                class="add-to-cart-btn p-1 text-primary border border-primary rounded-full hover:bg-primary hover:text-white transition duration-200">
                            <i class="fas fa-plus text-xs"></i>
                        </button>
                    </li>
                `).join('');

                const cardHtml = `
                    <div id="${category.id}-card" class="menu-card bg-white rounded-lg shadow-xl overflow-hidden transition duration-300 hover:shadow-2xl cursor-pointer">
                        <div class="h-64 overflow-hidden">
                            <img src="${category.imgSrc}" alt="${category.title.substring(1)}"
                                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
                        </div>
                        <h3 class="p-4 text-2xl font-bold text-center ${category.theme.bgClass} ${category.theme.titleColor}">
                            ${category.title}
                        </h3>

                        <div class="menu-detail bg-white p-6 border-t border-gray-200">
                            <h4 class="text-xl font-bold mb-3 border-b ${category.theme.detailBorder} pb-2">${category.categoryName}</h4>
                            <ul class="space-y-2 text-sm text-gray-700">
                                ${itemsHtml}
                            </ul>
                        </div>
                    </div>
                `;
                menuGrid.insertAdjacentHTML('beforeend', cardHtml);
            });
            attachMenuEventListeners();
        };

        /**
         * é™„è‘—äº‹ä»¶ç›£è½å™¨åˆ°èœå–®é …ç›®ä¸Š
         */
        const attachMenuEventListeners = () => {
            // é»æ“Šå¡ç‰‡åœ¨è¡Œå‹•è£ç½®ä¸Šå±•é–‹/æ”¶åˆ
            document.querySelectorAll('.menu-card').forEach(card => {
                card.addEventListener('click', function (e) {
                    // å¦‚æœé»æ“Šç›®æ¨™æ˜¯è³¼ç‰©è»ŠæŒ‰éˆ•ï¼Œå‰‡ä¸è§¸ç™¼å±•é–‹/æ”¶åˆ
                    if (e.target.closest('.add-to-cart-btn')) return;

                    // åƒ…åœ¨å°è¢å¹•ä¸Šæˆ–æ²’æœ‰ hover æ•ˆæœæ™‚åˆ‡æ› active class
                    if (window.innerWidth < 768) {
                        this.classList.toggle('active');
                    }
                });
            });

            // åŠ å…¥è³¼ç‰©è»ŠæŒ‰éˆ•äº‹ä»¶
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const id = this.getAttribute('data-item-id');
                    const name = this.getAttribute('data-item-name');
                    const price = parseInt(this.getAttribute('data-item-price'));
                    if (id && name && !isNaN(price)) {
                        addToCart(id, name, price);
                    }
                });
            });
        };

        /**
         * é™„è‘—è³¼ç‰©è»Šå…§éƒ¨äº‹ä»¶ç›£è½å™¨ï¼ˆå› ç‚ºå…§å®¹å‹•æ…‹æ¸²æŸ“ï¼Œéœ€è¦ä¾è³´äº‹ä»¶å§”æ´¾ï¼‰
         */
        cartItemsContainer.addEventListener('click', (e) => {
            const minusButton = e.target.closest('.cart-quantity-minus');
            const plusButton = e.target.closest('.cart-quantity-plus');

            if (minusButton) {
                const itemId = minusButton.getAttribute('data-id');
                updateItemQuantity(itemId, -1);
            } else if (plusButton) {
                const itemId = plusButton.getAttribute('data-id');
                updateItemQuantity(itemId, 1);
            }
        });

        // å½ˆå‡ºè¨Šæ¯æç¤º (å–ä»£ alert)
        const showTemporaryMessage = (message, colorClass) => {
            const tempDiv = document.createElement('div');
            tempDiv.className = `fixed top-20 left-1/2 transform -translate-x-1/2 p-3 rounded-lg shadow-2xl bg-white border-2 ${colorClass} font-bold z-50 transition-opacity duration-300`;
            tempDiv.textContent = message;
            document.body.appendChild(tempDiv);
            setTimeout(() => {
                tempDiv.style.opacity = '0';
                tempDiv.addEventListener('transitionend', () => tempDiv.remove());
            }, 1500);
        };

        // --- è¦–åœ–æ§åˆ¶èˆ‡æ»¾å‹•åŠŸèƒ½ï¼ˆä¾†è‡ªæ‚¨çš„åŸå§‹ç¨‹å¼ç¢¼ï¼‰ ---
        const cartSidebar = document.getElementById('cart-sidebar');
        const cartOverlay = document.getElementById('cart-overlay');

        document.getElementById('cart-button').addEventListener('click', () => {
            cartSidebar.classList.add('open');
            cartOverlay.classList.remove('hidden');
        });

        document.getElementById('close-cart-button').addEventListener('click', () => {
            cartSidebar.classList.remove('open');
            cartOverlay.classList.add('hidden');
        });

        cartOverlay.addEventListener('click', () => {
            cartSidebar.classList.remove('open');
            cartOverlay.classList.add('hidden');
        });

        // åŸæœ‰åŠŸèƒ½ï¼šæ‰‹æ©Ÿæ¼¢å ¡é¸å–®é–‹åˆåŠŸèƒ½
        document.getElementById('menu-button').addEventListener('click', function () {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // åŸæœ‰åŠŸèƒ½ï¼šå¹³æ»‘æ»¾å‹•åŠŸèƒ½ (é»æ“Šå°èˆªé€£çµæ™‚)
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                if (this.getAttribute('href').length > 1) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);

                    if (targetId !== '#') {
                        document.getElementById('mobile-menu').classList.add('hidden');
                    }

                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 64, // æ‰£é™¤å›ºå®šå°èˆªåˆ—çš„é«˜åº¦
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });

        // --- æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ– ---
        window.onload = function () {
            renderMenuGrid();

            // å•Ÿå‹• Firestore è³¼ç‰©è»Šå³æ™‚ç›£è½å™¨
            const startCartListener = () => {
                if (!isAuthReady || !userId || !db) {
                    setTimeout(startCartListener, 100); // Wait for auth
                    return;
                }

                const cartRef = getCartCollectionRef();
                if (cartRef) {
                    onSnapshot(cartRef, (snapshot) => {
                        const cartItems = [];
                        snapshot.forEach(doc => {
                            // Firestore æ–‡ä»¶ ID ä½œç‚º item.id
                            cartItems.push({ id: doc.id, ...doc.data() });
                        });
                        // ç¢ºä¿è³¼ç‰©è»Šåˆ—è¡¨æŒ‰ç…§åŠ å…¥æ™‚é–“æ’åº (é›–ç„¶ Firestore å·²ç¶“æ˜¯æŒ‰ ID æ’åº)
                        cartItems.sort((a, b) => (a.addedAt > b.addedAt) ? 1 : -1);
                        renderCart(cartItems);
                    }, (error) => {
                        console.error("Firestore Cart Listener Failed:", error);
                        // åœ¨éŒ¯èª¤æ™‚é¡¯ç¤ºç©ºè³¼ç‰©è»Š
                        renderCart([]);
                    });
                }
            };

            // ç¢ºä¿ Firebase èªè­‰å®Œæˆå¾Œå†å•Ÿå‹•ç›£è½å™¨
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    startCartListener();
                }
            });
        };
    </script>
</body>

</html>